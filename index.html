<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>TD Schedule</title>
<style>
*{box-sizing:border-box;font-family:-apple-system,PingFang SC,Roboto,sans-serif;}
body{margin:0;background:#121212;color:#f1f1f1;display:flex;flex-direction:column;min-height:100vh;overflow:hidden;}
header{text-align:center;padding:16px 0;background:#1d1d1d;position:sticky;top:0;z-index:10;}
header h1{margin:0;font-size:22px;}
#week-range{font-size:14px;color:#bbb;margin-top:4px;}
main{
  flex:1;
  display:grid;
  grid-template-columns:repeat(6,1fr);
  grid-template-rows:repeat(2,1fr);
  gap:2px;
  background:#2a2a2a;
  height:60vh; /* æ§åˆ¶æ•´ä½“é«˜åº¦ */
  margin:16px;
  border:1px solid #333;
  border-radius:8px;
}
.day-cell{
  background:#1e1e1e;
  border:1px solid #2f2f2f;
  border-radius:4px;
  position:relative;
  padding:4px;
  overflow:hidden;
  display:flex;
  align-items:center;
  justify-content:center;
  min-height:80px;
}
.task{
  background:#2b4b6f;
  margin:2px 0;
  padding:4px 6px;
  border-radius:6px;
  font-size:12px;
  cursor:pointer;
  width:90%;
  text-align:center;
}
.task.done{background:#2e6f5e;}
#add-btn{
  position:fixed;
  bottom:24px;
  right:24px;
  width:64px;
  height:64px;
  border:none;
  border-radius:50%;
  background:#007bff;
  box-shadow:0 4px 12px rgba(0,0,0,0.3);
  cursor:pointer;
  display:flex;
  align-items:center;
  justify-content:center;
  transition:transform .2s ease,background .2s ease;
  z-index:999;
}
#add-btn:hover{transform:scale(1.1);background:#2196f3;}
#add-btn svg{width:32px;height:32px;fill:#fff;}
footer{text-align:center;padding:10px 0;font-size:13px;color:#777;background:#1d1d1d;}
#modal{
  position:fixed;
  top:0;left:0;
  width:100%;height:100%;
  background:rgba(0,0,0,.5);
  display:flex;
  align-items:center;
  justify-content:center;
  backdrop-filter:blur(4px);
  z-index:1000;
}
.hidden{display:none;}
.modal-content{
  background:#1e1e1e;
  padding:20px;
  border-radius:10px;
  width:90%;
  max-width:400px;
  max-height:80vh;
  overflow-y:auto;
  box-shadow:0 6px 20px rgba(0,0,0,0.5);
}
.modal-content input,textarea{
  width:100%;
  margin-bottom:8px;
  border:none;
  border-radius:4px;
  padding:6px;
  font-size:16px;
}
button{
  background:#2979ff;
  color:#fff;
  border:none;
  border-radius:4px;
  padding:8px 12px;
  margin:4px 2px;
  cursor:pointer;
}
@media(max-width:768px){
  main{grid-template-columns:repeat(3,1fr);grid-template-rows:repeat(4,1fr);height:70vh;}
}
</style>
</head>
<body>
<header>
  <h1>TD Schedule</h1>
  <div id="week-range"></div>
</header>

<main id="schedule"></main>

<button id="add-btn" title="æ·»åŠ ä»»åŠ¡">
  <svg viewBox="0 0 24 24"><path d="M19 11h-6V5h-2v6H5v2h6v6h2v-6h6z"/></svg>
</button>

<footer>Designed by Shawn</footer>

<!-- æ·»åŠ ä»»åŠ¡æµ®çª— -->
<div id="modal" class="hidden">
  <div class="modal-content">
    <h2>æ·»åŠ ä»»åŠ¡</h2>
    <label>æ—¥æœŸï¼š</label><input type="date" id="task-date" />
    <label>æ—¶é—´ï¼š</label><input type="time" id="task-time" />
    <label>è½¦å‹ï¼š</label><input type="text" id="task-model" />
    <label>é‡Œç¨‹ï¼š</label><input type="text" id="task-mileage" />
    <label>è½¦ç‰Œå·ï¼š</label><input type="text" id="task-plate" />
    <label>é¡¹ç›®ï¼š</label><input type="text" id="task-service" />
    <label>æŠ¥ä»·ï¼š</label><input type="text" id="task-price" />
    <label>è”ç³»æ–¹å¼ï¼š</label><input type="text" id="task-phone" />
    <label>å¤‡æ³¨ï¼š</label><textarea id="task-note"></textarea>
    <button id="save-task">ä¿å­˜</button>
    <button id="cancel-task">å–æ¶ˆ</button>
  </div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-app.js";
import { getDatabase, ref, set, get, onValue } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-database.js";
import { getAuth, signInAnonymously } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-auth.js";

// ğŸ”§ Firebaseé…ç½®
const firebaseConfig = {
  apiKey:"AIzaSyAyyrP8eLT174psGD9MJpZkK2iZ-_dbpS0",
  authDomain:"td-schedule-c010f.firebaseapp.com",
  databaseURL:"https://td-schedule-c010f-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId:"td-schedule-c010f",
  storageBucket:"td-schedule-c010f.firebasestorage.app",
  messagingSenderId:"747320547273",
  appId:"1:747320547273:web:15a251e4fbb45dd0557a18"
};
const app = initializeApp(firebaseConfig);
const db = getDatabase(app);
const auth = getAuth();
signInAnonymously(auth);

// ğŸ—“ï¸ æ„å»ºæ—¥æœŸè¡¨æ ¼
function getMonday(d){d=new Date(d);const day=d.getDay(),diff=d.getDate()-day+(day===0?-6:1);return new Date(d.setDate(diff));}
function fmt(d){return `${d.getMonth()+1}.${d.getDate()}`;}
function buildWeeks(){
  const now=new Date();
  const monday=getMonday(now);
  const nextWeek=new Date(monday);nextWeek.setDate(monday.getDate()+7);
  const week1End=new Date(monday);week1End.setDate(monday.getDate()+5);
  const week2End=new Date(nextWeek);week2End.setDate(nextWeek.getDate()+5);
  document.getElementById("week-range").textContent=`ã€æœ¬å‘¨ ${fmt(monday)}â€“${fmt(week1End)}ã€‘ | ã€ä¸‹å‘¨ ${fmt(nextWeek)}â€“${fmt(week2End)}ã€‘`;
  return [monday,nextWeek];
}

// æ¸²æŸ“ç©ºè¡¨æ ¼
function renderGrid(){
  const schedule=document.getElementById("schedule");
  schedule.innerHTML="";
  const [w1,w2]=buildWeeks();
  const days=[];
  for(let i=0;i<6;i++)days.push(new Date(w1.getFullYear(),w1.getMonth(),w1.getDate()+i));
  for(let i=0;i<6;i++)days.push(new Date(w2.getFullYear(),w2.getMonth(),w2.getDate()+i));
  days.forEach(date=>{
    ["AM","PM"].forEach(period=>{
      const div=document.createElement("div");
      div.className="day-cell";
      div.dataset.key=`${date.toISOString().split("T")[0]}_${period}`;
      schedule.appendChild(div);
    });
  });
}
renderGrid();

// ğŸ”„ ç›‘å¬æ•°æ®åº“å˜åŒ–
onValue(ref(db),snap=>{
  const data=snap.val()||{};
  document.querySelectorAll(".day-cell").forEach(c=>{
    c.innerHTML="";
    const key=c.dataset.key;
    const list=data[key]||[];
    list.forEach(i=>{
      const div=document.createElement("div");
      div.className="task"+(i.status?" done":"");
      div.textContent=`${i.time} ${i.service}`;
      c.appendChild(div);
    });
  });
});

// âœ³ï¸ æ·»åŠ ä»»åŠ¡é€»è¾‘
const modal=document.getElementById("modal");
document.getElementById("add-btn").onclick=()=>modal.classList.remove("hidden");
document.getElementById("cancel-task").onclick=()=>modal.classList.add("hidden");
document.getElementById("save-task").onclick=()=>{
  const d=document.getElementById("task-date").value;
  const t=document.getElementById("task-time").value;
  if(!d||!t){alert("è¯·é€‰æ‹©æ—¥æœŸå’Œæ—¶é—´");return;}
  const obj={
    time:t,
    model:task-model.value,
    mileage:task-mileage.value,
    plate:task-plate.value,
    service:task-service.value,
    price:task-price.value,
    phone:task-phone.value,
    note:task-note.value,
    status:false
  };
  const p=parseInt(t.split(":")[0])<12?"AM":"PM";
  const key=`${d}_${p}`;
  const r=ref(db,key);
  get(r).then(s=>{
    const l=s.val()||[];
    l.push(obj);
    set(r,l);
    modal.classList.add("hidden");
  });
};
</script>
</body>
</html>
