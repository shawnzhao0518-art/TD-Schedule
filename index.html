<!doctype html>
<html lang="zh">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>TD Schedule</title>
  <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
  <style>
    body {
      margin: 0;
      background: #0f0f0f;
      color: #fff;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    }

    header {
      text-align: center;
      padding: 16px;
      background: #141414;
      border-bottom: 1px solid #2a2a2a;
    }

    main {
      display: grid;
      grid-template-columns: 80px repeat(6, 1fr);
      grid-template-rows: repeat(4, 1fr);
      gap: 2px;
      padding: 4px;
      height: 80vh;
      background: #2a2a2a;
    }

    .time-label {
      display: flex;
      align-items: center;
      justify-content: center;
      border: 1px solid #333;
      font-weight: bold;
      background: #1d1d1d;
      color: #fff;
    }

    .day {
      border: 2px solid #333;
      display: flex;
      flex-direction: column;
      background: #181818;
    }

    .half {
      flex: 1;
      border-top: 1px solid #444;
      padding: 4px;
      overflow-y: auto;
    }

    .task {
      background: #2c4370;
      color: #fff;
      margin: 3px 0;
      padding: 4px 6px;
      border-radius: 4px;
      font-size: 13px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .task button {
      background: none;
      border: none;
      color: #bbb;
      cursor: pointer;
      font-size: 12px;
    }

    footer {
      text-align: center;
      padding: 10px;
      color: #777;
      border-top: 1px solid #2a2a2a;
    }

    .add-btn {
      position: fixed;
      bottom: 24px;
      right: 24px;
      width: 52px;
      height: 52px;
      background: #007aff;
      color: #fff;
      font-size: 28px;
      border-radius: 50%;
      display: flex;
      justify-content: center;
      align-items: center;
      cursor: pointer;
      box-shadow: 0 4px 12px rgba(0,0,0,0.3);
    }

    form {
      position: fixed;
      bottom: 100px;
      right: 24px;
      background: #1e1e1e;
      padding: 16px;
      border-radius: 8px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.4);
      display: none;
      flex-direction: column;
      gap: 8px;
      width: 250px;
    }

    form input, form select {
      background: #111;
      color: #fff;
      border: 1px solid #333;
      border-radius: 4px;
      padding: 6px;
      font-size: 14px;
    }

    form button {
      background: #007aff;
      border: none;
      padding: 8px;
      border-radius: 4px;
      color: #fff;
      font-weight: bold;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <header>
    <h1>TD Schedule</h1>
    <p>Êú¨Âë® 10.6 - 10.11„ÄÄ|„ÄÄ‰∏ãÂë® 10.13 - 10.18</p>
  </header>

  <main id="schedule"></main>

  <footer>Designed by Shawn</footer>

  <div class="add-btn" id="addBtn">+</div>

  <form id="taskForm">
    <input type="date" id="date" required>
    <select id="time">
      <option value="‰∏äÂçà">‰∏äÂçà</option>
      <option value="‰∏ãÂçà">‰∏ãÂçà</option>
    </select>
    <input type="text" id="car" placeholder="ËΩ¶ËæÜ" required>
    <input type="number" id="price" placeholder="ÈáëÈ¢ù" required>
    <button type="submit">Ê∑ªÂä†‰ªªÂä°</button>
  </form>

  <script>
    const { createClient } = supabase;
    const supabaseUrl = "https://mgrorhbschtyrdrekfhb.supabase.co";
    const supabaseKey = "sb_publishable_bbYg4Bl2F5uHC_3XqdH2RA_NOnp3wfc";
    const db = createClient(supabaseUrl, supabaseKey);

    const schedule = document.getElementById('schedule');
    const days = ['Âë®‰∏Ä','Âë®‰∫å','Âë®‰∏â','Âë®Âõõ','Âë®‰∫î','Âë®ÂÖ≠'];
    const weeks = ['Êú¨Âë®','‰∏ãÂë®'];

    // üß± Â∏ÉÂ±ÄÂàõÂª∫
    weeks.forEach(week => {
      ['‰∏äÂçà','‰∏ãÂçà'].forEach(label => {
        const labelCell = document.createElement('div');
        labelCell.className = 'time-label';
        labelCell.textContent = `${week}${label}`;
        schedule.appendChild(labelCell);

        days.forEach(() => {
          const day = document.createElement('div');
          day.className = 'day';

          const am = document.createElement('div');
          am.className = 'half';
          am.dataset.session = '‰∏äÂçà';

          const pm = document.createElement('div');
          pm.className = 'half';
          pm.dataset.session = '‰∏ãÂçà';

          day.appendChild(am);
          day.appendChild(pm);
          schedule.appendChild(day);
        });
      });
    });

    // üß© Ê∑ªÂä†‰ªªÂä°Ë°®Âçï
    const addBtn = document.getElementById('addBtn');
    const form = document.getElementById('taskForm');

    addBtn.addEventListener('click', () => {
      form.style.display = form.style.display === 'flex' ? 'none' : 'flex';
    });

    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      const date = document.getElementById('date').value;
      const time = document.getElementById('time').value;
      const car = document.getElementById('car').value;
      const price = parseFloat(document.getElementById('price').value);

      const { error } = await db.from('tasks').insert([{ date, time, car, price }]);
      if (error) alert('‚ùå ÊèíÂÖ•Â§±Ë¥•: ' + error.message);
      else {
        alert('‚úÖ Ê∑ªÂä†ÊàêÂäü');
        form.reset();
        form.style.display = 'none';
        loadTasks();
      }
    });

    // üßæ ËΩΩÂÖ•‰ªªÂä°
    async function loadTasks() {
      const { data, error } = await db.from('tasks').select('*');
      if (error) { console.error(error); return; }

      document.querySelectorAll('.half').forEach(h => h.innerHTML = '');
      data.forEach(task => {
        const divs = document.querySelectorAll(`.half[data-session="${task.time}"]`);
        divs.forEach(div => {
          const el = document.createElement('div');
          el.className = 'task';
          el.innerHTML = `${task.car} ¬•${task.price} <button onclick="deleteTask('${task.id}')">x</button>`;
          div.appendChild(el);
        });
      });
    }

    // üóë Âà†Èô§‰ªªÂä°
    async function deleteTask(id) {
      const { error } = await db.from('tasks').delete().eq('id', id);
      if (error) alert('‚ùå Âà†Èô§Â§±Ë¥•: ' + error.message);
      else loadTasks();
    }

    loadTasks();
  </script>
</body>
</html>
